---
title: "SAP - projekt"
subtitle: "Analiza spotify pjesama"
author: "Ema Smolić, Petar Borko, Antun Tišljar, Magda Milički"
date: "8.12.2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggstatsplot)
library(ggplot2)
```

```{r}
dim(SpotifyFeatures)
```

```{r}
head(SpotifyFeatures)
```
```{r}
names(SpotifyFeatures)
```

```{r}
summary(SpotifyFeatures)
```

```{r}
SpotifyFeatures %>% group_by(genre) %>% summarise(
  Mean.tempo=mean(tempo),
  Med.tempo=median(tempo),
  MeanTr.tempo=mean(tempo, trim = 0.1),
  IQR.tempo=IQR(tempo),
  sd.tempo=sd(tempo)
) -> summary.result1
summary.result1
```

```{r} 

ggplot(SpotifyFeatures, aes(x=tempo, y=genre)) +
  geom_boxplot(outlier.color="red" )

```

Boxplot svih srednjih vrijednosti
```{r}
boxplot(summary.result1[,c(2)])
```

Zadatak 1.
# todo: napravit tablicu koja prolazi po svim zanrovima i za svaki napise p vrijednost pripadajuceg t testa
```{r}
#results <- SpotifyFeatures %>% group_by(genre)
#result
t.test(SpotifyFeatures$tempo[SpotifyFeatures$genre=="A Capella"], mu=mean(SpotifyFeatures$tempo), alt="two.sided", conf.level = .95)
var(SpotifyFeatures$tempo[SpotifyFeatures$genre=="A Capella"])

t.test(SpotifyFeatures$tempo[SpotifyFeatures$genre=="Reggae"], mu=mean(SpotifyFeatures$tempo), alt="two.sided")
var(SpotifyFeatures$tempo[SpotifyFeatures$genre=="Reggae"])
```


Zadatak 2.

```{r}
durs = SpotifyFeatures$danceability[SpotifyFeatures$mode=="Major"]
mols = SpotifyFeatures$danceability[SpotifyFeatures$mode=="Minor"]
```

Provjeravamo pretpostavku normalnosti i nezavisnosti uzorka.

```{r}

h = hist(durs,
     breaks=20,
     main="Histogram plesnosti pjesama u duru")

h = hist(mols,
     breaks=20,
     main="Histogram plesnosti pjesama u molu")

```

```{r}
qqnorm(durs, pch = 1, frame = FALSE, main = "Plesnost u duru")
qqline(durs, col = "steelblue", lwd = 2)

qqnorm(durs, pch = 1, frame = FALSE, main = "Plesnost u molu")
qqline(mols, col = "green", lwd = 2)
```




```{r}
var(durs)
var(mols)
```

Racunamo razliku varijanci:

```{r}
var.test(mols, durs)
```

Mala p-vrijednost nam govori da odbacimo nultu hipotezu te da varijance nisu jednake.

H0 = {pjesme u duru su jednako plesnije kao pjesme u molu}
H1 = {pjesme u duru su plesnije od pjesama u molu}

```{r}

t.test(durs, mols, alt="greater", var.equal=FALSE)
t.test(durs, mols, alt="less", var.equal=FALSE)
```

Prvim t-testom  smo pokazali da ne odbacujemo nultu hipotezu da su pjesme u duru jednako plesne kao u molu,
a drugim smo odbacili nultu hipotezu i mozemo zakljuciti da su pjesme u molu plesnije od pjesama u duru.




3. zadatak

```{r}
plot(SpotifyFeatures$energy,SpotifyFeatures$popularity)
plot(SpotifyFeatures$valence,SpotifyFeatures$popularity)
plot(SpotifyFeatures$tempo,SpotifyFeatures$popularity)
plot(SpotifyFeatures$danceability,SpotifyFeatures$popularity)
plot(SpotifyFeatures$duration_ms,SpotifyFeatures$popularity)
plot(SpotifyFeatures$instrumentalness,SpotifyFeatures$popularity)
plot(SpotifyFeatures$speechiness,SpotifyFeatures$popularity)
```

```{r}
fit.energy = lm(popularity~energy,data=SpotifyFeatures)

plot(SpotifyFeatures$energy,SpotifyFeatures$popularity)
lines(SpotifyFeatures$energy,fit.energy$fitted.values,col='red')

fit.tempo = lm(popularity~tempo,data=SpotifyFeatures)
plot(SpotifyFeatures$tempo,SpotifyFeatures$popularity)
lines(SpotifyFeatures$tempo,fit.tempo$fitted.values,col='red')

fit.danceability = lm(popularity~danceability,data=SpotifyFeatures)
plot(SpotifyFeatures$danceability,SpotifyFeatures$popularity)
lines(SpotifyFeatures$danceability,fit.danceability$fitted.values,col='red')

fit.duration_ms= lm(popularity~duration_ms,data=SpotifyFeatures)
plot(SpotifyFeatures$duration_ms,SpotifyFeatures$popularity)
lines(SpotifyFeatures$duration_ms,fit.duration_ms$fitted.values,col='red')

fit.instrumentalness = lm(popularity~instrumentalness,data=SpotifyFeatures)
plot(SpotifyFeatures$instrumentalness,SpotifyFeatures$popularity)
lines(SpotifyFeatures$instrumentalness,fit.instrumentalness$fitted.values,col='red')

fit.speechiness = lm(popularity~speechiness,data=SpotifyFeatures)
plot(SpotifyFeatures$speechiness,SpotifyFeatures$popularity)
lines(SpotifyFeatures$speechiness,fit.speechiness$fitted.values,col='red')

fit.loudness = lm(popularity~loudness,data=SpotifyFeatures)
plot(SpotifyFeatures$loudness,SpotifyFeatures$popularity)
lines(SpotifyFeatures$loudness,fit.loudness$fitted.values,col='red')
```







```{r}
selected.model = fit.loudness
plot(selected.model$residuals)

hist((selected.model$residuals))
hist(rstandard(selected.model))

qqnorm(rstandard(selected.model))
qqline(rstandard(selected.model))

plot(selected.model$fitted.values,selected.model$residuals)
 
ks.test(rstandard(fit.tempo),'pnorm')

require(nortest)
lillie.test(rstandard(fit.tempo))
```




```{r}

summary(fit.loudness)

summary(fit.energy)

summary(fit.danceability)

summary(fit.speechiness)

summary(fit.instrumentalness)

```



```{r}
cor(SpotifyFeatures$loudness,SpotifyFeatures$popularity)

cor.test(SpotifyFeatures$loudness,SpotifyFeatures$popularity)
```


```{r}
fit.loudness_dance = lm(popularity ~ danceability + instrumentalness, SpotifyFeatures) #regresija s jako koreliranim varijablama
summary(fit.loudness_dance)

cor(SpotifyFeatures$danceability,SpotifyFeatures$loudness)
```