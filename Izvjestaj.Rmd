---
title: "SAP - projekt"
subtitle: "Analiza spotify pjesama"
author: "Ema Smolić, Petar Borko, Antun Tišljar, Magda Milički"
date: "8.12.2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggstatsplot)
library(ggplot2)
```

```{r}
dim(SpotifyFeatures)
```

```{r}
head(SpotifyFeatures)
```
```{r}
names(SpotifyFeatures)
```

```{r}
summary(SpotifyFeatures)
```

```{r}
SpotifyFeatures %>% group_by(genre) %>% summarise(
  Mean.tempo=mean(tempo),
  Med.tempo=median(tempo),
  MeanTr.tempo=mean(tempo, trim = 0.1),
  IQR.tempo=IQR(tempo),
  sd.tempo=sd(tempo)
) -> summary.result1
summary.result1
```

```{r} 

ggplot(SpotifyFeatures, aes(x=tempo, y=genre)) +
  geom_boxplot(outlier.color="red" )

```

Boxplot svih srednjih vrijednosti
```{r}
boxplot(summary.result1[,c(2)])
```
note> izbrisi t test, ostavi tablicu radi varijanci
Zadatak 1.
```{r}
#HERE
genres <- unique(SpotifyFeatures$genre) 
ps <- list()
i <- 1
vars <- list()

for(g in genres) {
  print(g)
  t_test = t.test(SpotifyFeatures$tempo[SpotifyFeatures$genre==g], mu=mean(SpotifyFeatures$tempo), alt="two.sided", conf.level = .95)
  print(t_test) 
  ps[i] <- t_test$p.value
  vars[i] <- var(SpotifyFeatures$tempo[SpotifyFeatures$genre==g])
  i <- i + 1
  #print(var(SpotifyFeatures$tempo[SpotifyFeatures$genre==g]))
}
genres_ps <- do.call(rbind, Map(data.frame, genre=genres, p_value=ps, vars=vars))
print(genres_ps)

bartlett.test(SpotifyFeatures$tempo ~ SpotifyFeatures$genre)

var((SpotifyFeatures$tempo[SpotifyFeatures$genre=='Pop']))
```
Iako je p-vrijednost Bartlettovog testa vrlo mala, vidimo da su varijance dovoljno blizu za provo]enje ANOVA testa.


```{r}
a = aov(SpotifyFeatures$tempo ~ SpotifyFeatures$genre)
summary(a)
```
p-vrijednost ANOVA testa manja je od 2*10 -16 pa odbacujemo H0 i yakljucujemo da barem dva zanra koji nemaju jednaki tempo.

Zadatak 2.

```{r}
durs = SpotifyFeatures$danceability[SpotifyFeatures$mode=="Major"]
mols = SpotifyFeatures$danceability[SpotifyFeatures$mode=="Minor"]
```

Provjeravamo pretpostavku normalnosti i nezavisnosti uzorka.

```{r}

h = hist(durs,
     breaks=20,
     main="Histogram plesnosti pjesama u duru")

h = hist(mols,
     breaks=20,
     main="Histogram plesnosti pjesama u molu")

```

```{r}
qqnorm(durs, pch = 1, frame = FALSE, main = "Plesnost u duru")
qqline(durs, col = "steelblue", lwd = 2)

qqnorm(durs, pch = 1, frame = FALSE, main = "Plesnost u molu")
qqline(mols, col = "green", lwd = 2)
```




```{r}
var(durs)
var(mols)
```

Racunamo razliku varijanci:

```{r}
var.test(mols, durs)
```

Mala p-vrijednost nam govori da odbacimo nultu hipotezu te da varijance vrlo vjerojatno nisu jednake.

H0 = {pjesme u duru su jednako plesne kao pjesme u molu}
H1 = {pjesme u duru su plesnije od pjesama u molu}

```{r}

t.test(durs, mols, alt="two.sided", var.equal=FALSE)

t.test(durs, mols, alt="greater", var.equal=FALSE)
t.test(durs, mols, alt="less", var.equal=FALSE)
```

# Prvim t-testom  smo pokazali da ne odbacujemo nultu hipotezu da su pjesme u duru jednako plesne kao u molu,
# a drugim smo odbacili nultu hipotezu da pjesme u duru nisu manje plesne (jednake srednje vrijednosti) od onih u molu.

Odbacili smo hipotezu da su aritm. vrijednosti plesnosti pjesama u duru i onih u molu jednake u korist alternativne hipoteze da su pjesme u duru manje 
plesne od onih u molu.




3. zadatak


```{r}
col_names = names(SpotifyFeatures)
col_names = col_names[-c(1,2,3,4,5,11,14,17)]
```

grafovi su takvi ybog prevelike kolicine podataka  *dataseta
```{r}
plot(SpotifyFeatures$energy,SpotifyFeatures$popularity)
plot(SpotifyFeatures$valence,SpotifyFeatures$popularity)
plot(SpotifyFeatures$tempo,SpotifyFeatures$popularity)
plot(SpotifyFeatures$danceability,SpotifyFeatures$popularity)
plot(SpotifyFeatures$duration_ms,SpotifyFeatures$popularity)
plot(SpotifyFeatures$instrumentalness,SpotifyFeatures$popularity)
plot(SpotifyFeatures$speechiness,SpotifyFeatures$popularity)
plot(SpotifyFeatures$loudness,SpotifyFeatures$popularity)
```





```{r} 

log_dur <- SpotifyFeatures$duration_ms


fit.loudness = lm(popularity~log_dur,data=SpotifyFeatures)
plot(log_dur,SpotifyFeatures$popularity)
lines(log_dur,fit.loudness$fitted.values,col='red')
``` 


```{r} 
pop <- SpotifyFeatures %>% filter(SpotifyFeatures$genre == "R&B")
print(pop)
```


```{r}
pop <- data.frame(pop)
fit.energy = lm(popularity~energy,data=pop)
plot(pop$energy,pop$popularity)
lines(pop$energy,fit.energy$fitted.values,col='red')

fit.tempo = lm(popularity~tempo,data=pop)
plot(pop$tempo,pop$popularity)
lines(pop$tempo,fit.tempo$fitted.values,col='red')

fit.danceability = lm(popularity~danceability,data=pop)
plot(pop$danceability,pop$popularity)
lines(pop$danceability,fit.danceability$fitted.values,col='red')

fit.duration_ms= lm(popularity~duration_ms,data=pop)
plot(pop$duration_ms,pop$popularity)
lines(pop$duration_ms,fit.duration_ms$fitted.values,col='red')

fit.instrumentalness = lm(popularity~instrumentalness,data=pop)
plot(pop$instrumentalness,pop$popularity)
lines(pop$instrumentalness,fit.instrumentalness$fitted.values,col='red')

fit.speechiness = lm(popularity~speechiness,data=pop)
plot(pop$speechiness,pop$popularity)
lines(pop$speechiness,fit.speechiness$fitted.values,col='red')

fit.loudness = lm(popularity~loudness,data=pop)
plot(pop$loudness,pop$popularity)
lines(pop$loudness,fit.loudness$fitted.values,col='red')
```







```{r}
# TODO: prikazati tablicu sa svim svojstvima
selected.model = fit.instrumentalness
plot(selected.model$residuals)

hist((selected.model$residuals))
hist(rstandard(selected.model))

qqnorm(rstandard(selected.model))
qqline(rstandard(selected.model))

plot(selected.model$fitted.values,selected.model$residuals)
 
ks.test(rstandard(selected.model),'pnorm')

require(nortest)
lillie.test(rstandard(selected.model))

```




```{r}

summary(fit.loudness)

summary(fit.energy)

summary(fit.danceability)

summary(fit.speechiness)

summary(fit.instrumentalness)

```



```{r}
cor(SpotifyFeatures$duration_ms,SpotifyFeatures$popularity)

cor.test(SpotifyFeatures$duration_ms,SpotifyFeatures$popularity)
```


```{r}

fit.loudness_dance = lm(popularity ~ danceability + loudness + duration_ms + valence, SpotifyFeatures) #regresija s jako koreliranim varijablama
summary(fit.loudness_dance) 
# Popularity i tempo nisu korelirani i zato tempo ne utjece u regresiju 
```

```{r}
require(caret)

logreg.mdl = glm(pop$popularity/100 ~ pop$liveness + pop$energy + pop$speechiness + pop$instrumentalness, data = pop, family = binomial())
summary(logreg.mdl)
```